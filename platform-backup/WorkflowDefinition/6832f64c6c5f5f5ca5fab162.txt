{
	"appsUsed":[
		"storage_by_unifyapps"
	],
	"createdTime":1748544404625,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1758655384814,
		"deployedBy":0,
		"deployedDefinitionId":"68d2f39838757c179b123ae1",
		"status":"DEPLOYED",
		"version":45,
		"workflowVersion":72
	},
	"edges":[
		{
			"fromNodeId":"VYGAM",
			"priority":0,
			"skip":false,
			"toNodeId":"jQ3QV",
			"type":"next"
		},
		{
			"fromNodeId":"jQ3QV",
			"priority":0,
			"skip":false,
			"toNodeId":"wursZ",
			"type":"next"
		},
		{
			"fromNodeId":"wursZ",
			"priority":0,
			"skip":false,
			"toNodeId":"DVl9E",
			"type":"next"
		},
		{
			"fromNodeId":"DVl9E",
			"priority":0,
			"skip":false,
			"toNodeId":"O3oEX",
			"type":"next"
		},
		{
			"fromNodeId":"O3oEX",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"Yi4ln",
			"type":"if"
		},
		{
			"fromNodeId":"Yi4ln",
			"priority":0,
			"skip":false,
			"toNodeId":"FMDKy",
			"type":"next"
		},
		{
			"fromNodeId":"O3oEX",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"FMDKy",
			"type":"next"
		},
		{
			"fromNodeId":"FMDKy",
			"priority":0,
			"skip":false,
			"toNodeId":"uQu68",
			"type":"next"
		},
		{
			"fromNodeId":"uQu68",
			"priority":0,
			"skip":false,
			"toNodeId":"msRaB",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"6832f64c6c5f5f5ca5fab162",
	"lastModifiedBy":-1,
	"lcName":"graphrag | de-duplication | fetch neighbours for node",
	"modifiedTime":1759243566908,
	"name":"GraphRAG | De-duplication | Fetch Neighbours for Node",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceName":"callables_from_automation"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"JFlfj@gV50U-1@l",
			"id":"VYGAM",
			"index":0,
			"inputs":{
				"result":{
					"type":"object",
					"properties":{
						"neighbours":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Neighbours"
						},
						"cur_node_id":{
							"type":"string",
							"title":"Cur Node Id"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"setup":{
					"$schema":"http://json-schema.org/draft-07/schema#",
					"type":"object",
					"properties":{
						"item":{
							"type":"string"
						},
						"dedupThreshold":{
							"type":"number",
							"title":"Dedup Threshold",
							"default":"0.98"
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger via automation",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":382,
				"resourceName":"storage_by_unifyapps_fetch_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"JFlfj@gV50U-1@l",
			"id":"jQ3QV",
			"index":0,
			"inputs":{
				"object_type":"ai_agent",
				"includeRoleMappings":false,
				"includeCurrentUserPermissions":false,
				"page":{
					"paginateBy":"OFFSET",
					"limit":20
				},
				"numberOfRecordsToFetch":"SINGLE",
				"includeTotalCount":false
			},
			"skip":true,
			"subTitle":"GraphRAG Settings",
			"title":"Fetch records",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":379,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"JFlfj@gV50U-1@l",
			"id":"wursZ",
			"index":0,
			"inputs":{
				"compile_static":false,
				"code":"return []"
			},
			"skip":true,
			"subTitle":"TODO: Fetch dedup Thr",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":379,
				"resourceName":"storage_by_unifyapps_fetch_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"JFlfj@gV50U-1@l",
			"id":"DVl9E",
			"index":0,
			"inputs":{
				"triggerInputCondition":{
					"filters":[
						{
							"property":"id",
							"filter":{
								"operator":"EQUAL",
								"value":"{{ VYGAM.outputs.item  }}"
							}
						}
					],
					"operator":"AND"
				},
				"searchField":{
					"fields":[]
				},
				"object_type":"graph_rag_node_vector_store",
				"includeRoleMappings":false,
				"includeCurrentUserPermissions":false,
				"page":{
					"paginateBy":"OFFSET",
					"limit":20
				},
				"numberOfRecordsToFetch":"SINGLE",
				"includeTotalCount":false
			},
			"skip":false,
			"subTitle":"Storage by UnifyApps",
			"title":"Fetch records",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":371,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"JFlfj@gV50U-1@l",
			"id":"O3oEX",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ DVl9E.outputs.id }}",
						"filter":{
							"operator":"MISSING"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":383,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"O3oEX@JFlfj@gV50U-1@l@y",
			"id":"Yi4ln",
			"index":0,
			"inputs":{
				"result":{
					"cur_node_id":"{{ VYGAM.outputs.item }}"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":378,
				"resourceName":"storage_by_unifyapps_semantic_query_records",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"JFlfj@gV50U-1@l",
			"id":"FMDKy",
			"index":0,
			"inputs":{
				"hybridSearch":false,
				"triggerInputCondition":{
					"filters":[
						{
							"property":"properties_graphId",
							"filter":{
								"operator":"EQUAL",
								"value":"{{ DVl9E.outputs.properties.graphId }}"
							}
						}
					],
					"operator":"AND"
				},
				"searchField":{
					"op":"KNN",
					"field":"properties.embeddings",
					"values":"{{ DVl9E.outputs.properties.embeddings }}"
				},
				"object_type":"graph_rag_node_vector_store",
				"numberOfRecordsToFetch":200
			},
			"skip":false,
			"subTitle":"kNN",
			"title":"Semantic search records",
			"type":"ACTION"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.parameters.dbOutput.items"
				]
			},
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":377,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"JFlfj@gV50U-1@l",
			"id":"uQu68",
			"index":0,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"neighbours":{
							"type":"array",
							"items":{
								"type":"string"
							},
							"title":"Neighbours"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"input":{
					"type":"object",
					"properties":{
						"dbOutput":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Db Output"
						},
						"currentId":{
							"type":"string",
							"title":"Current Id"
						},
						"dedupThreshold":{
							"type":"number",
							"title":"Dedup Threshold"
						},
						"graphId":{
							"type":"string",
							"title":"Graph Id"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"compile_static":false,
				"code":"// return an empty list when dbOutput is missing or empty ---------------------\nif ( !binding.hasVariable('dbOutput') || !dbOutput ) {\n    return [ neighbours : [] ]\n}\n\n// normal flow ----------------------------------------------------------------\ndef neighbours = dbOutput\n        // 1. score threshold\n        .findAll { hit ->\n            if (hit?.score == null) return false\n            double transformed = (hit.score as double) - 1\n            transformed >= dedupThreshold\n        }\n\n        // 2. focus on the document section\n        .collect { it.document }\n\n        // 3. keep only documents that have nodeId AND the right graphId\n        .findAll { doc ->\n            def props = doc.properties\n            props?.nodeId &&\n            props?.graphId?.toString() == graphId.toString()\n        }\n\n        // 4. extract nodeId\n        .collect { it.properties.nodeId as String }\n\n        // 5. nodeId must be smaller than the “winner”\n        .findAll { it < currentId }\n\nreturn [ neighbours : neighbours ]",
				"parameters":{
					"dbOutput":{
						"source":"{{ FMDKy.outputs.objects }}",
						"ua:type":"mappedArray",
						"items":"{{ FMDKy.outputs.objects[0] }}"
					},
					"currentId":"{{ VYGAM.outputs.item  }}",
					"dedupThreshold":"{{ VYGAM.outputs.dedupThreshold }}",
					"graphId":"{{ DVl9E.outputs.properties.graphId }}"
				}
			},
			"skip":false,
			"subTitle":"Format",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"JFlfj@gV50U-1@l",
			"id":"msRaB",
			"index":0,
			"inputs":{
				"result":{
					"neighbours":{
						"source":"{{ uQu68.outputs.result.neighbours }}",
						"ua:type":"mappedArray",
						"items":"{{ uQu68.outputs.result.neighbours[0] }}"
					},
					"cur_node_id":"{{ VYGAM.outputs.item }}"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":1728,
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"headerValueTierMap":{},
			"tierName":"global"
		}
	},
	"standard":true,
	"version":73
}