{
	"appsUsed":[
		"storage_by_unifyapps"
	],
	"createdTime":1740110516938,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1759243648769,
		"deployedBy":-1,
		"deployedDefinitionId":"68dbed8023e6682b9a51ed98",
		"status":"DEPLOYED",
		"version":72,
		"workflowVersion":121
	},
	"edges":[
		{
			"fromNodeId":"GpPp2",
			"priority":0,
			"skip":false,
			"toNodeId":"AU2XH",
			"type":"next"
		},
		{
			"fromNodeId":"AU2XH",
			"priority":0,
			"skip":false,
			"toNodeId":"oCvHo",
			"type":"next"
		},
		{
			"fromNodeId":"oCvHo",
			"priority":0,
			"skip":false,
			"toNodeId":"O9a4D",
			"type":"next"
		},
		{
			"fromNodeId":"O9a4D",
			"priority":0,
			"skip":false,
			"toNodeId":"1fKko",
			"type":"next"
		},
		{
			"fromNodeId":"1fKko",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"8dmtm",
			"type":"if"
		},
		{
			"fromNodeId":"8dmtm",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"n_pyQiC",
			"type":"if"
		},
		{
			"fromNodeId":"n_pyQiC",
			"priority":0,
			"skip":false,
			"toNodeId":"n_E3poi",
			"type":"next"
		},
		{
			"fromNodeId":"n_E3poi",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_7MCRD",
			"type":"if"
		},
		{
			"fromNodeId":"_7MCRD",
			"priority":0,
			"skip":false,
			"toNodeId":"IpVpw",
			"type":"next"
		},
		{
			"fromNodeId":"n_E3poi",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"IpVpw",
			"type":"next"
		},
		{
			"fromNodeId":"IpVpw",
			"priority":0,
			"skip":false,
			"toNodeId":"1aRDq",
			"type":"next"
		},
		{
			"fromNodeId":"1aRDq",
			"priority":0,
			"skip":false,
			"toNodeId":"AUynK",
			"type":"next"
		},
		{
			"fromNodeId":"8dmtm",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"AUynK",
			"type":"next"
		},
		{
			"fromNodeId":"AUynK",
			"priority":0,
			"skip":false,
			"toNodeId":"mVYSJ",
			"type":"next"
		},
		{
			"fromNodeId":"mVYSJ",
			"priority":0,
			"skip":false,
			"toNodeId":"vtZuM",
			"type":"next"
		},
		{
			"fromNodeId":"vtZuM",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"34eTT",
			"type":"if"
		},
		{
			"fromNodeId":"vtZuM",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"NGH6j",
			"type":"next"
		},
		{
			"fromNodeId":"34eTT",
			"priority":0,
			"skip":false,
			"toNodeId":"hIFiy",
			"type":"next"
		},
		{
			"fromNodeId":"NGH6j",
			"priority":0,
			"skip":false,
			"toNodeId":"hIFiy",
			"type":"next"
		},
		{
			"fromNodeId":"1fKko",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"hIFiy",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"67b3331d5e9b4f0225bf8276",
	"lastModifiedBy":-1,
	"lcName":"publishcitations tool",
	"modifiedTime":1759371966452,
	"name":"publishCitations Tool",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceVersion":16,
				"resourceName":"callables_from_interface"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"GpPp2",
			"index":1,
			"inputs":{
				"result":{
					"additionalProperties":false,
					"ua:modal":{
						"field_type":"STRING",
						"is_optional":true
					},
					"type":"object",
					"properties":{
						"toolOutput":{
							"type":"string",
							"title":"toolOutput"
						},
						"success":{
							"type":"boolean",
							"title":"Success"
						},
						"error":{
							"type":"string",
							"title":"Error"
						}
					},
					"required":[]
				},
				"callableInterfaceId":"679484ef9c8ab5620dca9609",
				"setup":{
					"additionalProperties":false,
					"ua:modal":{
						"field_type":"STRING",
						"is_optional":true
					},
					"type":"object",
					"properties":{
						"toolId":{
							"type":"string",
							"title":"toolId"
						},
						"toolInputs":{
							"type":"object",
							"title":"toolInputs"
						},
						"triggeredByAgentId":{
							"type":"string",
							"title":"Triggered By Agent Id"
						},
						"agentResponseMessageId":{
							"type":"string",
							"title":"Agent Response Message Id"
						},
						"caseId":{
							"type":"string",
							"title":"Case Id"
						},
						"executeUsingModel":{
							"type":"string",
							"title":"Execute Using Model"
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger interface",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"variable_by_unifyapps",
				"resourceVersion":16,
				"resourceName":"variable_by_unifyapps_get_session_variables",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"AU2XH",
			"index":2,
			"inputs":{
				"variableSchema":{
					"type":"object",
					"properties":{
						"caseId":{
							"type":"string",
							"title":"Case Id"
						}
					},
					"additionalProperties":false,
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"caseId",
			"title":"Get Session Variables",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":17,
				"resourceName":"storage_by_unifyapps_get_record_by_id",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"oCvHo",
			"index":3,
			"inputs":{
				"object_type":"e_ai_agent_conversation_state",
				"includeRoleMappings":false,
				"includeCurrentUserPermissions":false,
				"translationsOption":"DEFAULT",
				"id":"{{ AU2XH.outputs.caseId }}",
				"readThroughSessionVariables":false
			},
			"skip":false,
			"subTitle":"conv state",
			"title":"Fetch records",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":11,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"O9a4D",
			"index":4,
			"inputs":{
				"output":{
					"type":"object",
					"additionalProperties":false,
					"required":[
						"chunkIds",
						"answer",
						"chartId"
					],
					"properties":{
						"chunkIds":{
							"type":"array",
							"items":{
								"type":"integer"
							},
							"title":"Chunk Ids"
						},
						"answer":{
							"type":"string",
							"title":"Answer"
						},
						"chartId":{
							"type":"string",
							"title":"Chart Id"
						},
						"toolInputs":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"toolInputs"
						}
					}
				},
				"input":{
					"type":"object",
					"additionalProperties":false,
					"required":[
						"toolInputs"
					],
					"properties":{
						"toolInputs":{
							"type":"object",
							"properties":{},
							"additionalProperties":false,
							"title":"Tool Inputs"
						}
					}
				},
				"code":"if(!binding.hasVariable('toolInputs')){\n  return [:]\n}\ndef tmp = [chunkIds: toolInputs.chunkIds?.collect { it as Integer }, answer:toolInputs.answer, chartId:toolInputs.chartId]\ntoolInputs.remove(\"answer\")\ntmp[\"toolInputs\"] = toolInputs\nreturn tmp",
				"compile_static":false,
				"captureStdOutput":false,
				"parameters":{
					"toolInputs":"{{ GpPp2.outputs.toolInputs }}"
				}
			},
			"skip":false,
			"subTitle":"Get chunkIds",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":71,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"1fKko",
			"index":5,
			"inputs":{
				"filters":[
					{
						"property":"{{ O9a4D.outputs.result.chunkIds[0] }}",
						"filter":{
							"operator":"MISSING"
						}
					},
					{
						"property":"1",
						"filter":{
							"operator":"EQUAL",
							"value":"1"
						}
					}
				],
				"operator":"OR"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":77,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"1fKko@kFhpo-1@y",
			"id":"8dmtm",
			"index":6,
			"inputs":{
				"filters":[
					{
						"property":"{{ GpPp2.outputs.agentResponseMessageId }}",
						"filter":{
							"operator":"EXISTS"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"agentResponseMessageId",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":469,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"8dmtm@1fKko@kFhpo-1@y@y",
			"id":"n_pyQiC",
			"index":7,
			"inputs":{
				"automationId":"685914facb8d060a8c7b1481",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"caseId":"{{ AU2XH.outputs.caseId }}",
					"blockType":"Citation",
					"aiAgentId":"{{ GpPp2.outputs.triggeredByAgentId }}",
					"chunkNo":{
						"source":"{{ O9a4D.outputs.result.chunkIds }}",
						"ua:type":"mappedArray",
						"items":"{{ O9a4D.outputs.result.chunkIds[0] }}"
					}
				}
			},
			"skip":false,
			"subTitle":"Generate citation data from chunk IDs",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":439,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"8dmtm@1fKko@kFhpo-1@y@y",
			"id":"n_E3poi",
			"index":8,
			"inputs":{
				"filters":[
					{
						"property":"=LEN({{ n_pyQiC.outputs.imageBlock.data }})",
						"filter":{
							"operator":"GT",
							"value":"0"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"images?",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":82,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"n_E3poi@8dmtm@1fKko@kFhpo-1@y@y@y",
			"id":"_7MCRD",
			"index":9,
			"inputs":{
				"automationId":"67bddfb5ac77be6d502052c7",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"coPilotBlock":"{{ n_pyQiC.outputs.imageBlock }}",
					"messageId":"{{ GpPp2.outputs.agentResponseMessageId }}",
					"caseId":"{{ AU2XH.outputs.caseId }}"
				}
			},
			"skip":false,
			"subTitle":"images",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":82,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"8dmtm@1fKko@kFhpo-1@y@y",
			"id":"IpVpw",
			"index":10,
			"inputs":{
				"automationId":"67bddfb5ac77be6d502052c7",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"coPilotBlock":"{{ n_pyQiC.outputs.citationData[0] }}",
					"messageId":"{{ GpPp2.outputs.agentResponseMessageId }}",
					"caseId":"{{ AU2XH.outputs.caseId }}"
				}
			},
			"skip":false,
			"subTitle":"citations",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":80,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"8dmtm@1fKko@kFhpo-1@y@y",
			"id":"1aRDq",
			"index":11,
			"inputs":{
				"result":{
					"success":true,
					"toolOutput":"citations published"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":199,
				"resourceName":"callables_call_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"1fKko@kFhpo-1@y",
			"id":"AUynK",
			"index":12,
			"inputs":{
				"automationId":"67f439a9faf9a1695c2e7fa9",
				"runtimeConnections":{},
				"synchronous":true,
				"version":"-1",
				"parameters":{
					"aiAgentId":"{{ GpPp2.outputs.triggeredByAgentId }}",
					"answer":"{{ O9a4D.outputs.result.answer }}"
				}
			},
			"skip":true,
			"subTitle":"Guardrail on Answer",
			"title":"Call automation",
			"type":"CALL_WORKFLOW"
		},
		{
			"context":{
				"appName":"conv_ai_by_unifyapps",
				"resourceVersion":50,
				"resourceName":"conv_ai_by_unifyapps_publish_response",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"1fKko@kFhpo-1@y",
			"id":"mVYSJ",
			"index":13,
			"inputs":{
				"callableInterfaceId":"__ua__publish_response_interface",
				"parameters":{
					"responses":[
						{
							"content":"{{ AUynK.outputs.response }}"
						}
					],
					"caseId":"{{ AU2XH.outputs.caseId }}",
					"publishToEndUser":false
				}
			},
			"skip":false,
			"subTitle":"Conversation AI by UnifyApps",
			"title":"Publish Response",
			"type":"CALL_INTERFACE_WORKFLOW"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":55,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"1fKko@kFhpo-1@y",
			"id":"vtZuM",
			"index":14,
			"inputs":{
				"filters":[
					{
						"property":"{{ mVYSJ.outputs.messageId }}",
						"filter":{
							"operator":"EXISTS"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"messageId present ?",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"additional":{
				"visibleOptionalFields":[
					"root.updateFields.items.fieldName",
					"root.updateFields.items.actionType"
				]
			},
			"context":{
				"appName":"storage_by_unifyapps",
				"resourceVersion":438,
				"resourceName":"storage_by_unifyapps_update_record_fields_by_id",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"vtZuM@1fKko@kFhpo-1@y@y",
			"id":"34eTT",
			"index":15,
			"inputs":{
				"recordId":"{{ mVYSJ.outputs.messageId }}",
				"writeThroughSessionVariables":true,
				"object_type":"service_hub_message",
				"skipPermissionCheck":false,
				"updateFields":[
					{
						"fieldName":"properties.content.agentResponse.toolUseDetails.toolName",
						"actionType":"SET",
						"setValue":"PublishCitations"
					},
					{
						"fieldName":"properties.content.agentResponse.toolUseDetails.toolId",
						"actionType":"SET",
						"setValue":"{{ GpPp2.outputs.toolId }}"
					},
					{
						"fieldName":"properties.content.agentResponse.toolUseDetails.toolOutput",
						"actionType":"SET",
						"setValue":"Published Citations to User"
					},
					{
						"fieldName":"properties.content.agentResponse.toolUseDetails.toolInput",
						"actionType":"SET",
						"setValue":"{{ O9a4D.outputs.result.toolInputs }}"
					}
				]
			},
			"skip":false,
			"subTitle":"update tool Usage",
			"title":"Update an existing record's fields",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":57,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"vtZuM@1fKko@kFhpo-1@y@n",
			"id":"NGH6j",
			"index":16,
			"inputs":{
				"result":{
					"success":true
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":17,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"kFhpo-1",
			"id":"hIFiy",
			"index":17,
			"inputs":{
				"result":{
					"success":true,
					"toolOutput":"Published citations"
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":1866,
	"schemaReferences":[
		"entity|e_code_snippet|e_6877aa91786e8b57f766d3ad",
		"entity|e_code_snippet|e_6838b3cdab73e649c4592fa5"
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"tierName":"global"
		}
	},
	"standard":true,
	"tags":[
		"AI Agent",
		"Internal"
	],
	"version":122
}