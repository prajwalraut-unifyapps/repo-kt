{
	"appsUsed":[
		"whatsapp"
	],
	"createdTime":1733009234613,
	"deleted":false,
	"deploymentState":{
		"deployedAt":1758655355892,
		"deployedBy":0,
		"deployedDefinitionId":"68d2f37b38757c179b1235ec",
		"status":"DEPLOYED",
		"version":22,
		"workflowVersion":46
	},
	"edges":[
		{
			"fromNodeId":"_cDTr9",
			"priority":0,
			"skip":false,
			"toNodeId":"_EjOI6",
			"type":"next"
		},
		{
			"fromNodeId":"_EjOI6",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_kTp3P",
			"type":"if"
		},
		{
			"fromNodeId":"_kTp3P",
			"priority":0,
			"skip":false,
			"toNodeId":"_4R7Rq",
			"type":"loop"
		},
		{
			"fromNodeId":"_4R7Rq",
			"name":"1",
			"priority":0,
			"skip":false,
			"toNodeId":"_4R7Rq@1",
			"type":"branch"
		},
		{
			"fromNodeId":"_4R7Rq@1",
			"priority":0,
			"skip":false,
			"toNodeId":"_gnDzO",
			"type":"next"
		},
		{
			"fromNodeId":"_gnDzO",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_hVdWH",
			"type":"if"
		},
		{
			"fromNodeId":"_gnDzO",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"_67B7r",
			"type":"next"
		},
		{
			"fromNodeId":"_4R7Rq",
			"name":"2",
			"priority":0,
			"skip":false,
			"toNodeId":"_4R7Rq@2",
			"type":"branch"
		},
		{
			"fromNodeId":"_4R7Rq@2",
			"priority":0,
			"skip":false,
			"toNodeId":"_ppQSj",
			"type":"next"
		},
		{
			"fromNodeId":"_ppQSj",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_KsFtm",
			"type":"if"
		},
		{
			"fromNodeId":"_ppQSj",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"_4jOlp",
			"type":"next"
		},
		{
			"fromNodeId":"_hVdWH",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"_kTp3P",
			"type":"next"
		},
		{
			"fromNodeId":"_67B7r",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"_kTp3P",
			"type":"next"
		},
		{
			"fromNodeId":"_KsFtm",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"_kTp3P",
			"type":"next"
		},
		{
			"fromNodeId":"_4jOlp",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"_kTp3P",
			"type":"next"
		},
		{
			"fromNodeId":"_4R7Rq",
			"name":"default",
			"priority":0,
			"skip":false,
			"toNodeId":"_kTp3P",
			"type":"next"
		},
		{
			"fromNodeId":"_EjOI6",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"Cz42O",
			"type":"next"
		},
		{
			"fromNodeId":"Cz42O",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"FVfIV",
			"type":"if"
		},
		{
			"fromNodeId":"FVfIV",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"hgmk1",
			"type":"if"
		},
		{
			"fromNodeId":"FVfIV",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"4xNzR",
			"type":"next"
		},
		{
			"fromNodeId":"Cz42O",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"_tbL9N",
			"type":"next"
		},
		{
			"fromNodeId":"_tbL9N",
			"priority":0,
			"skip":false,
			"toNodeId":"_wWx8b",
			"type":"next"
		},
		{
			"fromNodeId":"_wWx8b",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_cehDh",
			"type":"if"
		},
		{
			"fromNodeId":"_cehDh",
			"priority":0,
			"skip":false,
			"toNodeId":"_4ycx3",
			"type":"loop"
		},
		{
			"fromNodeId":"_4ycx3",
			"name":"yes",
			"priority":0,
			"skip":false,
			"toNodeId":"_vNCmD",
			"type":"if"
		},
		{
			"fromNodeId":"_4ycx3",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"_oNK7A",
			"type":"next"
		},
		{
			"fromNodeId":"_vNCmD",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"_cehDh",
			"type":"next"
		},
		{
			"fromNodeId":"_oNK7A",
			"name":"loopback",
			"priority":0,
			"skip":false,
			"toNodeId":"_cehDh",
			"type":"next"
		},
		{
			"fromNodeId":"_wWx8b",
			"name":"no",
			"priority":0,
			"skip":false,
			"toNodeId":"_ctTFf",
			"type":"next"
		},
		{
			"fromNodeId":"_kTp3P",
			"priority":0,
			"skip":false,
			"toNodeId":"_Emjpx",
			"type":"next"
		},
		{
			"fromNodeId":"hgmk1",
			"priority":0,
			"skip":false,
			"toNodeId":"_Emjpx",
			"type":"next"
		},
		{
			"fromNodeId":"4xNzR",
			"priority":0,
			"skip":false,
			"toNodeId":"_Emjpx",
			"type":"next"
		},
		{
			"fromNodeId":"_cehDh",
			"priority":0,
			"skip":false,
			"toNodeId":"_Emjpx",
			"type":"next"
		},
		{
			"fromNodeId":"_ctTFf",
			"priority":0,
			"skip":false,
			"toNodeId":"_Emjpx",
			"type":"next"
		}
	],
	"grants":{
		"configs":[
			{
				"permissions":[
					"V"
				],
				"principalType":"GLOBAL"
			}
		]
	},
	"id":"674b9f526f65877474634fe9",
	"lastModifiedBy":-1,
	"lcName":"whatsapp publisher (ai agent)",
	"modifiedTime":1759243542359,
	"name":"Whatsapp Publisher (AI Agent)",
	"nodes":[
		{
			"context":{
				"appName":"callables",
				"resourceVersion":86,
				"resourceName":"callables_from_interface"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_Yd8t7-1",
			"id":"_cDTr9",
			"index":0,
			"inputs":{
				"result":{
					"additionalProperties":false,
					"ua:modal":{
						"field_type":"STRING",
						"is_optional":true
					},
					"type":"object",
					"properties":{
						"success":{
							"type":"boolean",
							"title":"success"
						}
					}
				},
				"callableInterfaceId":"66e80063f5ec4205eb06242c",
				"setup":{
					"additionalProperties":false,
					"ua:modal":{
						"field_type":"STRING",
						"is_optional":true
					},
					"type":"object",
					"properties":{
						"endConversation":{
							"type":"boolean",
							"title":"endConversation"
						},
						"choices":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"id":{
										"type":"string",
										"title":"id"
									},
									"title":{
										"type":"string",
										"title":"title"
									}
								},
								"additionalProperties":false
							},
							"title":"choices"
						},
						"content":{
							"type":"string",
							"title":"content"
						},
						"url":{
							"type":"string",
							"title":"url"
						},
						"caseId":{
							"type":"string",
							"title":"Case"
						},
						"lang":{
							"type":"string",
							"title":"Lang"
						},
						"attachments":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{
									"name":{
										"type":"string",
										"title":"Name"
									},
									"url":{
										"type":"string",
										"title":"Url"
									},
									"type":{
										"type":"string",
										"title":"Type"
									},
									"mimeType":{
										"type":"string",
										"title":"Mime Type"
									}
								},
								"additionalProperties":false
							},
							"title":"Attachments",
							"required":[]
						},
						"input":{
							"type":"object",
							"properties":{
								"triggerInput":{
									"type":"object",
									"properties":{},
									"additionalProperties":false,
									"title":"Trigger Input"
								},
								"userInputsForPublish":{
									"type":"object",
									"properties":{},
									"additionalProperties":false,
									"title":"User Inputs For Publish"
								}
							},
							"additionalProperties":false,
							"title":"Input",
							"required":[]
						},
						"coPilotBlocks":{
							"type":"array",
							"items":{
								"type":"object",
								"properties":{},
								"additionalProperties":false
							},
							"title":"Co Pilot Blocks"
						},
						"caseDetails":{
							"type":"object",
							"properties":{
								"customerUserDetails":{
									"type":"object",
									"properties":{
										"channelUserId":{
											"type":"string",
											"title":"Channel User Id"
										}
									},
									"additionalProperties":false,
									"title":"Customer User Details",
									"required":[]
								}
							},
							"additionalProperties":false,
							"title":"Case Details",
							"required":[]
						}
					},
					"required":[]
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Trigger interface",
			"trigger":{
				"type":"CALLABLE"
			},
			"type":"START"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":54,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_Yd8t7-1",
			"id":"_EjOI6",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ _cDTr9.outputs.url }}",
						"filter":{
							"operator":"EXISTS"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"loop",
				"resourceVersion":97,
				"resourceName":"loop_for_each",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_EjOI6@_Yd8t7-1@y",
			"id":"_kTp3P",
			"index":0,
			"inputs":{
				"repeatMode":"SINGLE",
				"listSource":"{{ _cDTr9.outputs.attachments }}"
			},
			"skip":false,
			"subTitle":"Loop",
			"title":"For loop",
			"type":"LOOP"
		},
		{
			"context":{
				"appName":"branch",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_kTp3P@_EjOI6@_Yd8t7-1@y@l",
			"id":"_4R7Rq",
			"index":0,
			"inputs":{
				"branches":[
					{
						"id":"1",
						"inputs":{
							"name":"Branch 1",
							"conditions":{
								"filters":[
									{
										"property":"{{ _kTp3P.outputs.item.type }}",
										"filter":{
											"operator":"EQUAL",
											"value":"image"
										}
									}
								],
								"operator":"AND"
							}
						}
					},
					{
						"id":"2",
						"inputs":{
							"name":"Branch 2",
							"conditions":{
								"filters":[
									{
										"property":"{{ _kTp3P.outputs.item.type }}",
										"filter":{
											"operator":"EQUAL",
											"value":"video"
										}
									}
								],
								"operator":"AND"
							}
						}
					},
					{
						"id":"default"
					}
				]
			},
			"skip":false,
			"subTitle":"Branch",
			"title":"",
			"type":"BRANCH"
		},
		{
			"context":{
				"appName":"branch_condition",
				"resourceVersion":40,
				"resourceName":"branch_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_4R7Rq@_kTp3P@_EjOI6@_Yd8t7-1@y@l@1",
			"id":"_4R7Rq@1",
			"index":0,
			"inputs":{
				"name":"Branch 1",
				"conditions":{
					"filters":[
						{
							"property":"{{ _kTp3P.outputs.item.type }}",
							"filter":{
								"operator":"EQUAL",
								"value":"image"
							}
						}
					],
					"operator":"AND"
				}
			},
			"skip":false,
			"title":"",
			"type":"BRANCH_CONDITION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":54,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_4R7Rq@_kTp3P@_EjOI6@_Yd8t7-1@y@l@1",
			"id":"_gnDzO",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ _kTp3P.outputs.isFirst }}",
						"filter":{
							"operator":"EQUAL",
							"value":"true"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"whatsapp",
				"resourceVersion":3,
				"resourceName":"whatsapp_send_attachment",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_gnDzO@_4R7Rq@_kTp3P@_EjOI6@_Yd8t7-1@y@l@1@y",
			"id":"_hVdWH",
			"index":0,
			"inputs":{
				"recipient_type":"individual",
				"image":{
					"link":"{{ _kTp3P.outputs.item.url }}",
					"image_type":"url",
					"caption":"{{ _cDTr9.outputs.content }}"
				},
				"messaging_product":"whatsapp",
				"to":"{{ _cDTr9.outputs.caseDetails.customerUserDetails.channelUserId }}",
				"type":"image"
			},
			"skip":false,
			"subTitle":"WhatsApp",
			"title":"Send attachment",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"whatsapp",
				"resourceVersion":3,
				"resourceName":"whatsapp_send_attachment",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_gnDzO@_4R7Rq@_kTp3P@_EjOI6@_Yd8t7-1@y@l@1@n",
			"id":"_67B7r",
			"index":0,
			"inputs":{
				"recipient_type":"individual",
				"image":{
					"link":"{{ _kTp3P.outputs.item.url }}"
				},
				"messaging_product":"whatsapp",
				"to":"{{ _cDTr9.outputs.caseDetails.customerUserDetails.channelUserId }}",
				"type":"image"
			},
			"skip":false,
			"subTitle":"WhatsApp",
			"title":"Send attachment",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"branch_condition",
				"resourceVersion":40,
				"resourceName":"branch_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_4R7Rq@_kTp3P@_EjOI6@_Yd8t7-1@y@l@2",
			"id":"_4R7Rq@2",
			"index":0,
			"inputs":{
				"name":"Branch 2",
				"conditions":{
					"filters":[
						{
							"property":"{{ _kTp3P.outputs.item.type }}",
							"filter":{
								"operator":"EQUAL",
								"value":"video"
							}
						}
					],
					"operator":"AND"
				}
			},
			"skip":false,
			"title":"",
			"type":"BRANCH_CONDITION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":54,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_4R7Rq@_kTp3P@_EjOI6@_Yd8t7-1@y@l@2",
			"id":"_ppQSj",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ _kTp3P.outputs.isFirst }}",
						"filter":{
							"operator":"EQUAL",
							"value":"true"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"whatsapp",
				"resourceVersion":3,
				"resourceName":"whatsapp_send_attachment",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_ppQSj@_4R7Rq@_kTp3P@_EjOI6@_Yd8t7-1@y@l@2@y",
			"id":"_KsFtm",
			"index":0,
			"inputs":{
				"recipient_type":"individual",
				"messaging_product":"whatsapp",
				"video":{
					"link":"{{ _kTp3P.outputs.item.url }}",
					"video_type":"url",
					"caption":"{{ _cDTr9.outputs.content }}"
				},
				"to":"{{ _cDTr9.outputs.caseDetails.customerUserDetails.channelUserId }}",
				"type":"video"
			},
			"skip":false,
			"subTitle":"WhatsApp",
			"title":"Send attachment",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"whatsapp",
				"resourceVersion":3,
				"resourceName":"whatsapp_send_attachment",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_ppQSj@_4R7Rq@_kTp3P@_EjOI6@_Yd8t7-1@y@l@2@n",
			"id":"_4jOlp",
			"index":0,
			"inputs":{
				"recipient_type":"individual",
				"messaging_product":"whatsapp",
				"to":"{{ _cDTr9.outputs.caseDetails.customerUserDetails.channelUserId }}",
				"video":{
					"link":"{{ _kTp3P.outputs.item.url }}"
				},
				"type":"video"
			},
			"skip":false,
			"subTitle":"WhatsApp",
			"title":"Send attachment",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":32,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_EjOI6@_Yd8t7-1@n",
			"id":"Cz42O",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"=LEN({{ ysaHW.outputs.choices }})",
						"filter":{
							"operator":"GT",
							"value":"0"
						}
					},
					{
						"property":"{{ ysaHW.outputs.url }}",
						"filter":{
							"operator":"EXISTS"
						}
					}
				],
				"operator":"OR"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":0,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"Cz42O@_EjOI6@_Yd8t7-1@n@y",
			"id":"FVfIV",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"=LEN({{ ysaHW.outputs.choices }})",
						"filter":{
							"operator":"GT",
							"value":"3"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"whatsapp",
				"resourceVersion":56,
				"resourceName":"whatsapp_send_list_picker_template",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"FVfIV@Cz42O@_EjOI6@_Yd8t7-1@n@y@y",
			"id":"hgmk1",
			"index":0,
			"inputs":{
				"recipient_type":"individual",
				"messaging_product":"whatsapp",
				"interactive":{
					"type":"list",
					"header":{
						"type":"text",
						"text":"👋 Welcome "
					},
					"action":{
						"sections":{
							"items":{
								"rows":{
									"ua:type":"mappedArray",
									"items":{
										"id":"{{ _cDTr9.outputs.choices[0].id }}",
										"title":"{{ _cDTr9.outputs.choices[0].title }}",
										"description":"{{ _cDTr9.outputs.choices[0].id }}"
									},
									"source":"{{ _cDTr9.outputs.choices }}"
								},
								"title":"Choices"
							},
							"ua:type":"mappedArray"
						},
						"button":"Options"
					},
					"body":{
						"text":"{{ _cDTr9.outputs.content }}"
					}
				},
				"to":"{{ _cDTr9.outputs.caseDetails.customerUserDetails.channelUserId }}"
			},
			"skip":false,
			"subTitle":"WhatsApp",
			"title":"Send list picker template",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"whatsapp",
				"resourceVersion":2,
				"resourceName":"whatsapp_send_card_template",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"FVfIV@Cz42O@_EjOI6@_Yd8t7-1@n@y@n",
			"id":"4xNzR",
			"index":0,
			"inputs":{
				"header_type":"text",
				"action":{
					"buttons":{
						"ua:type":"mappedArray",
						"items":{
							"type":"reply",
							"reply":{
								"id":"{{ _cDTr9.outputs.choices[0].id }}",
								"title":"{{ _cDTr9.outputs.choices[0].title }}"
							}
						},
						"source":"{{ _cDTr9.outputs.choices }}"
					}
				},
				"text":" ",
				"to":"{{ _cDTr9.outputs.caseDetails.customerUserDetails.channelUserId }}",
				"body":"{{ _cDTr9.outputs.content }}"
			},
			"skip":false,
			"subTitle":"WhatsApp",
			"title":"Send card template",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"code_by_unifyapps",
				"resourceVersion":3,
				"resourceName":"code_by_unifyapps_groovy",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"Cz42O@_EjOI6@_Yd8t7-1@n@n",
			"id":"_tbL9N",
			"index":0,
			"inputs":{
				"output":{
					"type":"object",
					"properties":{
						"output":{
							"type":"object",
							"properties":{
								"text":{
									"type":"string",
									"title":"Text"
								},
								"hasImages":{
									"type":"boolean",
									"title":"Has Images"
								},
								"imageUrls":{
									"type":"array",
									"items":{
										"type":"string"
									},
									"title":"Image Urls"
								},
								"imageTitles":{
									"type":"array",
									"items":{
										"type":"string"
									},
									"title":"Image Titles"
								}
							},
							"additionalProperties":false,
							"title":"Output",
							"required":[]
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"input":{
					"type":"object",
					"properties":{
						"content":{
							"type":"string",
							"title":"Content"
						}
					},
					"additionalProperties":false,
					"required":[]
				},
				"code":"class TextImageParser {\n    static def parseTextWithImages(String text) {\n        // Regular expressions for different image formats\n        def markdownPattern = /!\\[([^\\]]*)\\]\\(([^)]+)\\)/\n        def htmlPattern = /<img[^>]+src=[\"'](.*?)[\"']/\n        def urlListPattern = /Product Image Url:\\s*((?:https?:\\/\\/[^,\\s]+(?:\\s*,\\s*https?:\\/\\/[^,\\s]+)*))/ \n        \n        // Initialize result map\n        def result = [\n            text: text,\n            hasImages: false,\n            imageUrls: [],\n            imageTitles: []\n        ]\n        \n        // Check for URL list format first\n        def urlListMatcher = text =~ urlListPattern\n        if (urlListMatcher.find()) {\n            // Split URLs by comma and trim whitespace\n            def urls = urlListMatcher.group(1).split(\",\").collect { it.trim() }\n            result.imageUrls.addAll(urls)\n            // Add empty titles for each URL\n            urls.each { result.imageTitles << \"\" }\n            // Remove the URL list from text\n            result.text = text.replaceAll(urlListPattern, '').trim()\n            result.hasImages = true\n            return result\n        }\n        \n        // If no URL list found, check for markdown/HTML formats\n        def combinedPattern = /$markdownPattern|$htmlPattern/\n        def matcher = text =~ combinedPattern\n        \n        while (matcher.find()) {\n            if (matcher.group(2)) {  // Markdown format\n                result.imageUrls << matcher.group(2)\n                result.imageTitles << (matcher.group(1) ?: '')\n            } else if (matcher.group(3)) {  // HTML format\n                result.imageUrls << matcher.group(3)\n                def altMatcher = matcher.group(0) =~ /alt=[\"']([^\"']*)[\"']/\n                result.imageTitles << (altMatcher.find() ? altMatcher.group(1) : '')\n            }\n        }\n        \n        // Remove all image patterns from text\n        result.text = text.replaceAll(combinedPattern, '').trim()\n        result.hasImages = !result.imageUrls.isEmpty()\n        \n        return result\n    }\n}\n\nreturn [\"output\":TextImageParser.parseTextWithImages(content)]",
				"isAsync":false,
				"parameters":{
					"content":"{{ _cDTr9.outputs.content }}"
				}
			},
			"skip":false,
			"subTitle":"Code by UnifyApps",
			"title":"Execute Groovy code",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":3,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"Cz42O@_EjOI6@_Yd8t7-1@n@n",
			"id":"_wWx8b",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ _tbL9N.outputs.result.output.hasImages }}",
						"filter":{
							"operator":"EQUAL",
							"value":"true"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"loop",
				"resourceVersion":8,
				"resourceName":"loop_for_each",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_wWx8b@Cz42O@_EjOI6@_Yd8t7-1@n@n@y",
			"id":"_cehDh",
			"index":0,
			"inputs":{
				"listSource":"{{ _tbL9N.outputs.result.output.imageUrls }}"
			},
			"skip":false,
			"subTitle":"Loop",
			"title":"For loop",
			"type":"LOOP"
		},
		{
			"context":{
				"appName":"if_else",
				"resourceVersion":8,
				"resourceName":"if_else_condition",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_cehDh@_wWx8b@Cz42O@_EjOI6@_Yd8t7-1@n@n@y@l",
			"id":"_4ycx3",
			"index":0,
			"inputs":{
				"filters":[
					{
						"property":"{{ _cehDh.outputs.isFirst }}",
						"filter":{
							"operator":"EQUAL",
							"value":"true"
						}
					}
				],
				"operator":"AND"
			},
			"skip":false,
			"subTitle":"Condition",
			"title":"Condition",
			"type":"IF_ELSE"
		},
		{
			"context":{
				"appName":"whatsapp",
				"resourceVersion":4,
				"resourceName":"whatsapp_send_attachment",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_4ycx3@_cehDh@_wWx8b@Cz42O@_EjOI6@_Yd8t7-1@n@n@y@l@y",
			"id":"_vNCmD",
			"index":0,
			"inputs":{
				"recipient_type":"individual",
				"image":{
					"link":"{{ _cehDh.outputs.item }}",
					"caption":"{{ _tbL9N.outputs.result.output.text }}",
					"image_type":"url"
				},
				"messaging_product":"whatsapp",
				"to":"{{ _cDTr9.outputs.caseDetails.customerUserDetails.channelUserId }}",
				"type":"image"
			},
			"options":{
				"businessHoursConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"cacheConfig":{
					"enabled":false
				},
				"circuitBreakerConfig":{
					"enabled":false
				},
				"disableLogging":false,
				"enabledForReExecution":false,
				"hookConfig":{
					"enabled":false
				},
				"logConfig":{
					"enabled":false
				},
				"rateLimitConfig":{
					"enabled":false,
					"waitForNextWindow":false
				},
				"retryConfig":{
					"backOffFactor":null,
					"captureRetries":false,
					"enabled":false
				},
				"stepError":"STOP",
				"telemetryConfig":{
					"enableTelemetry":false
				}
			},
			"skip":false,
			"subTitle":"WhatsApp",
			"title":"Send attachment",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"whatsapp",
				"resourceVersion":4,
				"resourceName":"whatsapp_send_attachment",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_4ycx3@_cehDh@_wWx8b@Cz42O@_EjOI6@_Yd8t7-1@n@n@y@l@n",
			"id":"_oNK7A",
			"index":0,
			"inputs":{
				"recipient_type":"individual",
				"image":{
					"link":"{{ _cehDh.outputs.item }}",
					"image_type":"url"
				},
				"messaging_product":"whatsapp",
				"to":"{{ _cDTr9.outputs.caseDetails.customerUserDetails.channelUserId }}",
				"type":"image"
			},
			"skip":false,
			"subTitle":"WhatsApp",
			"title":"Send attachment",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"whatsapp",
				"resourceVersion":2,
				"resourceName":"whatsapp_send_simple_text_message",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_wWx8b@Cz42O@_EjOI6@_Yd8t7-1@n@n@n",
			"id":"_ctTFf",
			"index":0,
			"inputs":{
				"recipient_type":"individual",
				"messaging_product":"whatsapp",
				"text":{
					"preview_url":false,
					"body":"{{ _cDTr9.outputs.content }}"
				},
				"to":"{{ _cDTr9.outputs.caseDetails.customerUserDetails.channelUserId }}",
				"type":"text"
			},
			"skip":false,
			"subTitle":"WhatsApp",
			"title":"Send simple text message",
			"type":"ACTION"
		},
		{
			"context":{
				"appName":"callables",
				"resourceVersion":79,
				"resourceName":"callables_return_to_automation",
				"type":"APPLICATION"
			},
			"debug":false,
			"dirty":false,
			"fallbackMode":"STOP",
			"groupId":"_Yd8t7-1",
			"id":"_Emjpx",
			"index":0,
			"inputs":{
				"result":{
					"success":true
				}
			},
			"skip":false,
			"subTitle":"Callable",
			"title":"Respond to automation",
			"type":"STOP"
		}
	],
	"ownerUserId":1866,
	"runtimeConnectionAppNames":[
		"whatsapp"
	],
	"schemaReferences":[
		
	],
	"settings":{
		"enableNodeLevelLogging":true,
		"enableRunLogging":true,
		"enableVariableLogging":true,
		"route":{
			"default":false,
			"headerValueTierMap":{},
			"tierName":"global"
		}
	},
	"standard":true,
	"tags":[
		"AI Agent",
		"Publish"
	],
	"version":47
}